<!doctype html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>èª­æ›¸ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
  <link rel="stylesheet" href="./home.css" />
  <link rel="stylesheet" href="./ranking.css" />
  <!-- jQuery / Chart.js -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="./insertHTML.js"></script>
  <script src="./pageswap.js"></script>
</head>

<body>
    <div class="app">
        <!-- ======= Header ======= -->
        <header>
            <div id="header"></div>
        </header>

        <!-- ======= Crumbs (ä»»æ„) ======= -->
        <!-- <div class="topbar" style="padding-top:8px;padding-bottom:0;">
            <div class="crumbs"><span>ğŸ“š <b>èª­æ›¸ç®¡ç†</b></span><span>â€º ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span></div>
        </div> -->

        <!-- ======= Main ======= -->
        <main>

            <!-- ===== Sidebar ===== -->
            <aside class="sidebar">

                <!-- ä»Šæœˆã®èª­æ›¸æ•°? -->
                <section class="panel">
                    <div class="hd">ä»Šæœˆã®èª­æ›¸æ•°</div>
                    <div class="bd">
                    <div style="font-size:32px; font-weight:800; margin-bottom:4px;">
                        <span id="monthlyCount">0</span>
                        <small style="font-size:14px; color:var(--muted); margin-left:2px;">å†Š</small>
                    </div>

                    <p class="muted" style="margin:8px 0 10px;">ç¾åœ¨ã®é€²æ—</p>
                    <div class="progress-wrap">
                        <div class="progress-box">ğŸ“˜</div>
                        <div>
                        <div class="progress-label">
                            <span class="muted">åŸºæœ¬æƒ…å ±æŠ€è¡“è€…è©¦é¨“</span>
                        </div>
                        <input type="range" id="progressSlider" value="0" min="0" max="100" />
                        <span id="progressPercent">0%</span>
                        <div class="row">
                            <button class="btn">æ›´æ–°</button>
                        </div>
                        </div>
                    </div>
                    </div>
                </section>

                <!-- ç™»éŒ²ãƒ»æ¤œç´¢ -->
                <section class="panel">
                    <div class="hd">æœ¬ã®ã‚¿ã‚¤ãƒˆãƒ«æ¤œç´¢</div>
                    <div class="bd search-bd">
                        <input type="text" id="bookTitleInput" placeholder="ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›" />
                        <nav><button onclick="showPage('kensaku')" id="searchBookBtn">æ¤œç´¢</button></nav>
                    </div>
                </section>

                <!-- ã‚¸ãƒ£ãƒ³ãƒ«ã‹ã‚‰é¸ã¶ -->
                <section class="panel">
                    <div class="hd">ã‚¸ãƒ£ãƒ³ãƒ«ã‹ã‚‰é¸ã¶</div>
                    <div class="bd">
                    <div class="chips" aria-label="ã‚¸ãƒ£ãƒ³ãƒ«">
                        <span class="chip">ãƒ“ã‚¸ãƒã‚¹</span>
                        <span class="chip">å°èª¬</span>
                        <span class="chip">æŠ€è¡“ãƒ»IT</span>
                        <span class="chip">èŠ¸è¡“ãƒ»æ–‡åŒ–</span>
                        <span class="chip">æ•°å­¦</span>
                    </div>
                    </div>
                </section>

                <!-- äººæ°—ãƒ¯ãƒ¼ãƒ‰ -->
                <section class="panel">
                    <div class="hd">äººæ°—ã®ãƒ¯ãƒ¼ãƒ‰ã‹ã‚‰é¸ã¶</div>
                    <div class="bd">
                    <div class="chips">
                        <span class="chip">çµ±è¨ˆ</span>
                        <span class="chip">AWS</span>
                        <span class="chip">Azure</span>
                        <span class="chip">ãƒ‡ã‚¶ã‚¤ãƒ³</span>
                    </div>
                    </div>
                </section>

                <!-- è‘—è€… -->
                <section class="panel">
                    <div class="hd">è‘—è€…åã‹ã‚‰é¸ã¶</div>
                    <div class="bd">
                    <div class="chips">
                        <span class="chip">AWS</span>
                        <span class="chip">Azure</span>
                        <span class="chip">TK</span>
                    </div>
                    </div>
                </section>

            </aside>

            <!-- ===== Content ===== -->
            <section class="content">

                <!-- ãƒšãƒ¼ã‚¸é·ç§» -->
                <div id="home" class="page active">
                    <!-- ãƒ©ãƒ³ã‚­ãƒ³ã‚° -->
                    <section class="panel">
                        <!-- ã‚¿ã‚¤ãƒˆãƒ«ã®å³ã«ãƒ•ã‚£ãƒ«ã‚¿ -->
                        <div class="header-bar">
                            <div class="title-line">
                            <span class="title">æœˆé–“èª­æ›¸æ•°ãƒ©ãƒ³ã‚­ãƒ³ã‚°</span>
                            <div class="filters">
                                <input type="month" id="month" class="pill" />
                                <select id="selDept" class="pill"><option value="">ã™ã¹ã¦ã®éƒ¨é–€</option></select>
                                <select id="selPos"  class="pill"><option value="">ã™ã¹ã¦ã®å½¹è·</option></select>
                            </div>
                            </div>
                        </div>

                        <div class="chart-wrap">
                            <div id="chartInner" class="chart-inner">
                            <canvas id="mainCanvas"></canvas>
                            </div>
                            <!-- ç©ºè¡¨ç¤ºï¼ˆä¸­å¤®ã«ï¼‰ -->
                            <div id="empty" class="empty">è©²å½“ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>
                        </div>

                        <script src="./ranking.js"></script>

                        <script>
                        const canvas = document.getElementById("mainCanvas");
                        canvas.width = data.labels.length * 100;  // ãƒ©ãƒ™ãƒ«æ•°Ã—å¹…ã§èª¿æ•´
                        </script>

                        <!-- <script> 
                        function resizeIframe() { 
                            const iframe = document.getElementById('rankingFrame'); 
                            if (iframe.contentWindow.document.body) { 
                                const height = iframe.contentWindow.document.body.scrollHeight; 
                                iframe.style.height = height + 25 + 'px'; 
                            } 
                        } 
                        document.getElementById('rankingFrame').addEventListener('load', resizeIframe); </script> -->
                    </section>
                </div>

                <!-- ãƒšãƒ¼ã‚¸é·ç§» -->
                <div id="kensaku" class="page">
                    <div id="bookSearchResults"></div>
                </div>

                <!-- ãƒšãƒ¼ã‚¸é·ç§» -->
                <div id="recomend" class="page">
                    <!-- ã‚ãªãŸã¸ã®ãŠã™ã™ã‚ -->
                    <section class="panel">
                        <div class="bd">
                        <div class="section-hd">
                            <strong>ã‚ãªãŸã¸ã®ãŠã™ã™ã‚</strong>
                            <span class="muted">æ›´æ–°: ä»Šæ—¥</span>
                        </div>
                        <div class="rail" aria-label="ã‚ãªãŸã¸ã®ãŠã™ã™ã‚ä¸€è¦§">
                            <div class="book"></div><div class="book"></div><div class="book"></div><div class="book"></div><div class="book"></div>
                        </div>
                        </div>
                    </section>
                </div>

                <!-- ãƒšãƒ¼ã‚¸é·ç§» -->
                <div id="popular" class="page">
                    <!-- ã¿ã‚“ãªãŒèª­ã‚“ã§ã„ã‚‹æœ¬ -->
                    <section class="panel">
                        <div class="bd">
                        <div class="section-hd">
                            <strong>ã¿ã‚“ãªãŒèª­ã‚“ã§ã„ã‚‹æœ¬</strong>
                            <span class="muted">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ </span>
                        </div>
                        <div class="rail" aria-label="ãƒˆãƒ¬ãƒ³ãƒ‰æœ¬ä¸€è¦§">
                            <div class="book"></div><div class="book"></div><div class="book"></div><div class="book"></div><div class="book"></div>
                        </div>
                        </div>
                    </section>
                </div>

                <!-- ãƒšãƒ¼ã‚¸é·ç§» -->
                 <div id="mypage" class="page">
                    <!-- ãƒã‚¤ãƒšãƒ¼ã‚¸ -->
                    <section class="panel">
                        <div class="bd">
                            <dl>
                            <dt>åå‰</dt>
                            <dd class="value">â—¯â—¯</dd>


                            <dt>ãƒ¡ãƒ¼ãƒ«</dt>
                            <dd class="value">â—¯â—¯.aiueo@jp.aaaaaa.bbbbb.com</dd>


                            <dt>æ‰€å±</dt>
                            <dd class="value">æŠ€è¡“æœ¬éƒ¨ã€€ã‚·ã‚¹ç ”</dd>


                            <dt>å¹´æ•°</dt>
                            <dd class="value">3å¹´ç›®</dd>


                            <dt>å½¹è·</dt>
                            <dd class="value">å‰¯ä¸»ä»»</dd>


                            <dt>è³‡æ ¼</dt>
                            <dd>
                            <div class="chips">
                            <span class="chip">åŸºæœ¬æƒ…å ±æŠ€è¡“è€…</span>
                            <span class="chip">å¿œç”¨æƒ…å ±æŠ€è¡“è€…</span>
                            </div>
                            </dd>
                            </dl>
                        </div>
                    </section>
                </div>

            </section>

        </main>
    </div>
    <script src="./progressupdate.js"></script>
    <script src="./search.js"></script>
    <!-- â˜… ãƒ©ãƒ³ã‚­ãƒ³ã‚° iframe ã‹ã‚‰ã®å†Šæ•°ã‚’å—ã‘å–ã‚Šè¡¨ç¤ºã™ã‚‹ï¼ˆè¿½è¨˜ï¼‰ -->
    <script>
        // 1) iframe ã‹ã‚‰ã®é€šçŸ¥ã‚’å—ä¿¡ã—ã¦ã€Œä»Šæœˆã®èª­æ›¸æ•°ã€ã‚’æ›´æ–°
        window.addEventListener('message', (e) => {
            const data = e?.data;
            if (!data || typeof data !== 'object') return;

            // é€²æ—100%ã®ã¿ã§é›†è¨ˆã•ã‚ŒãŸä»Šæœˆã®å†Šæ•°
            if (data.type === 'monthly-count') {
            const el = document.getElementById('monthlyCount');
            if (el) el.textContent = Number(data.count || 0);
            }

            // ï¼ˆä»»æ„ï¼‰æœˆå¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ã‘ãŸã„å ´åˆã¯ã“ã“ã§å‡¦ç†
            // if (data.type === 'month-change') { ... }
        });

        // 2) iframe èª­ã¿è¾¼ã¿å®Œäº†æ™‚ã«ã€åˆå›ã®å†Šæ•°é€ä¿¡ã‚’ä¾é ¼ï¼ˆä¿é™ºï¼‰
        const rankingFrame = document.getElementById('rankingFrame');
        rankingFrame.addEventListener('load', () => {
        // ãƒ©ãƒ³ã‚­ãƒ³ã‚°å´ï¼ˆranking.jsï¼‰ã§ã“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ã¦ monthly-count ã‚’ postMessage ã—ã¦ãã ã•ã„
        rankingFrame.contentWindow?.postMessage({ type: 'request-monthly-count' }, '*');
    });
    </script>

</body>

</html>
